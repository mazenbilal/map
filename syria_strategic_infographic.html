<!doctype html>
<html lang="ar" dir="rtl">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>أنفوغرافيك تفاعلي – الأبعاد الاستراتيجية (بدون مكتبات)</title>
<style>
  :root{
    --bg:#f6f7f9; --card:#fff; --ink:#0f172a; --muted:#667085; --grid:#e7eaee; --accent:#111827;
  }
  html,body{margin:0;background:var(--bg);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;color:var(--ink)}
  .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
  .hdr{margin:0 0 12px}
  .sub{color:var(--muted);font-size:13px;margin-top:4px}
  .grid{display:grid;gap:16px}
  @media(min-width:992px){.grid{grid-template-columns:1fr 1fr 1fr}}
  .card{background:var(--card);border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 1px 8px rgba(0,0,0,.06);padding:16px}
  .card h3{margin:0 0 10px}
  .row{display:flex;align-items:center;gap:8px;margin-bottom:10px}
  .row label{flex:0 0 160px;font-size:14px}
  .row input[type=range]{flex:1}
  .hint{font-size:12px;color:var(--muted)}
  .chart{width:100%;height:320px}
  .legend{display:flex;gap:12px;flex-wrap:wrap;font-size:12px;color:var(--muted);margin-top:6px}
  .badge{background:#eef2ff;color:#3730a3;border-radius:999px;padding:2px 8px}
  .barrow{display:grid;grid-template-columns:120px 1fr;align-items:center;margin:6px 0}
  .bar{height:28px;background:var(--accent);border-radius:8px;color:#fff;display:flex;align-items:center;justify-content:flex-end;padding-inline:8px}
  .tooltip{position:fixed;pointer-events:none;background:#111827;color:#fff;padding:6px 8px;border-radius:8px;font-size:12px;transform:translate(-50%,-140%);white-space:nowrap;z-index:50;display:none}
  .controls{display:grid;gap:10px}
  @media(min-width:992px){.controls{grid-template-columns:1fr}}
</style>

<body>
<div class="wrap">
  <h1 class="hdr">أنفوغرافيك تفاعلي – الأبعاد الاستراتيجية لموجة التصفيات</h1>
  <div class="sub">الفترة: 1–9 آب 2025 — إجمالي الضحايا: <span id="total">—</span></div>

  <div class="grid">
    <!-- الأوزان والرادار -->
    <section class="card">
      <h3>مصفوفة المخاطر (رادار) – اضبط الأوزان</h3>
      <div class="controls" id="controls"></div>
      <div class="chart">
        <svg id="radar" viewBox="0 0 400 400" width="100%" height="100%" aria-label="Radar chart">
          <!-- شبكة دائرية -->
        </svg>
      </div>
      <div class="legend">
        <span class="badge">0.5–1.5 وزن كل بُعد</span>
        <span>القيمة النهائية = التقييم × الوزن (حدّها الأقصى 10)</span>
      </div>
    </section>

    <!-- الخط الزمني -->
    <section class="card">
      <h3>التطور اليومي (1–9 آب)</h3>
      <div class="chart">
        <svg id="line" viewBox="0 0 600 320" width="100%" height="100%" aria-label="Daily victims line"></svg>
      </div>
      <div class="hint">مرّر مؤشر الفأرة على النقاط لرؤية العدد في كل يوم.</div>
    </section>

    <!-- المحافظات -->
    <section class="card">
      <h3>توزيع الضحايا حسب المحافظات</h3>
      <div id="bars"></div>
      <div class="hint">يمثل طول الشريط نسبة المحافظة إلى أعلى قيمة.</div>
    </section>
  </div>
</div>

<div class="tooltip" id="tip"></div>

<script>
/* ======= البيانات ======= */
const victimsByGov = [
  { name: "حلب", value: 8 },
  { name: "حمص", value: 6 },
  { name: "ريف دمشق", value: 5 },
  { name: "حماة", value: 3 },
  { name: "اللاذقية", value: 2 },
  { name: "دمشق", value: 2 },
  { name: "طرطوس", value: 1 },
];
document.getElementById('total').textContent =
  victimsByGov.reduce((a,b)=>a+b.value,0);

const dims = [
  {key:"vac",  label:"فراغ أمني",            score:9, desc:"تآكل قدرة الدولة على الردع."},
  {key:"sect", label:"تفكك طائفي",           score:8, desc:"تصاعد الهويات الصغرى."},
  {key:"imp",  label:"إفلات من العقاب",      score:9, desc:"ضعف المساءلة القضائية."},
  {key:"reg",  label:"تسرّب إقليمي",         score:6, desc:"قابلية الحدود للتوظيف."},
  {key:"soc",  label:"تآكل العقد الاجتماعي", score:8, desc:"الانكفاء للعائلة والطائفة."},
  {key:"fut",  label:"مخاطر مستقبلية",       score:7, desc:"توريث منطق الثأر."}
];
const weights = Object.fromEntries(dims.map(d=>[d.key,1]));

const daily = (() => {
  const arr = [5,2,5,1,6,2,3,3,0];
  arr[8] = Math.max(0, 27 - arr.slice(0,8).reduce((a,b)=>a+b,0));
  return arr.map((v,i)=>({day:i+1,victims:v}));
})();

/* ======= أدوات مساعدة ======= */
const tip = document.getElementById('tip');
function showTip(txt, x, y){
  tip.textContent = txt;
  tip.style.left = x+'px'; tip.style.top = y+'px';
  tip.style.display = 'block';
}
function hideTip(){ tip.style.display = 'none'; }

/* ======= مخطط الأعمدة (محافظات) ======= */
(function renderBars(){
  const cont = document.getElementById('bars');
  cont.innerHTML = '';
  const sorted = victimsByGov.slice().sort((a,b)=>b.value-a.value);
  const max = Math.max(...sorted.map(d=>d.value));
  sorted.forEach(d=>{
    const row = document.createElement('div');
    row.className = 'barrow';
    const lab = document.createElement('div'); lab.textContent = d.name;
    const bar = document.createElement('div'); bar.className='bar';
    bar.style.width = (d.value/max*100)+'%';
    bar.textContent = d.value;
    row.appendChild(lab); row.appendChild(bar); cont.appendChild(row);
  });
})();

/* ======= الرادار (SVG بدون مكتبات) ======= */
(function initRadar(){
  const svg = document.getElementById('radar');
  const cx = 200, cy = 200, rMax = 120;
  const axes = dims.length;

  // شبكة دائرية + محاور + تسميات
  const gGrid = document.createElementNS('http://www.w3.org/2000/svg','g');
  gGrid.setAttribute('stroke','#e5e7eb'); gGrid.setAttribute('fill','none');
  svg.appendChild(gGrid);

  for (let i=1;i<=5;i++){
    const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
    c.setAttribute('cx',cx); c.setAttribute('cy',cy);
    c.setAttribute('r',(rMax/5)*i); gGrid.appendChild(c);
  }

  const gAxes = document.createElementNS('http://www.w3.org/2000/svg','g');
  gAxes.setAttribute('stroke','#cbd5e1');
  svg.appendChild(gAxes);

  dims.forEach((d,idx)=>{
    const angle = (Math.PI*2*idx/axes) - Math.PI/2;
    const x = cx + rMax*Math.cos(angle);
    const y = cy + rMax*Math.sin(angle);
    const ln = document.createElementNS('http://www.w3.org/2000/svg','line');
    ln.setAttribute('x1',cx); ln.setAttribute('y1',cy);
    ln.setAttribute('x2',x); ln.setAttribute('y2',y);
    gAxes.appendChild(ln);

    const tx = cx + (rMax+24)*Math.cos(angle);
    const ty = cy + (rMax+24)*Math.sin(angle);
    const label = document.createElementNS('http://www.w3.org/2000/svg','text');
    label.setAttribute('x',tx); label.setAttribute('y',ty);
    label.setAttribute('font-size','12'); label.setAttribute('text-anchor','middle');
    label.textContent = d.label;
    svg.appendChild(label);
  });

  const poly = document.createElementNS('http://www.w3.org/2000/svg','polygon');
  poly.setAttribute('fill','#111827'); poly.setAttribute('fill-opacity','0.35');
  poly.setAttribute('stroke','#111827'); poly.setAttribute('stroke-width','2');
  svg.appendChild(poly);

  const pointsGroup = document.createElementNS('http://www.w3.org/2000/svg','g');
  svg.appendChild(pointsGroup);

  function updateRadar(){
    const pts = [];
    pointsGroup.innerHTML='';
    dims.forEach((d,idx)=>{
      const val = Math.min(10, d.score * (weights[d.key]||1)); // 0..10
      const ratio = val/10;
      const angle = (Math.PI*2*idx/axes) - Math.PI/2;
      const x = cx + rMax*ratio*Math.cos(angle);
      const y = cy + rMax*ratio*Math.sin(angle);
      pts.push(`${x},${y}`);

      const dot = document.createElementNS('http://www.w3.org/2000/svg','circle');
      dot.setAttribute('cx',x); dot.setAttribute('cy',y);
      dot.setAttribute('r',4); dot.setAttribute('fill','#111827');
      dot.addEventListener('mousemove',(e)=>showTip(`${d.label}: ${val.toFixed(1)} / 10`, e.clientX, e.clientY));
      dot.addEventListener('mouseleave',hideTip);
      pointsGroup.appendChild(dot);
    });
    poly.setAttribute('points', pts.join(' '));
  }

  // عناصر التحكم بالأوزان
  const controls = document.getElementById('controls');
  dims.forEach(d=>{
    const row = document.createElement('div'); row.className='row';
    const lab = document.createElement('label'); lab.textContent = d.label;
    const range = document.createElement('input');
    range.type='range'; range.min='0.5'; range.max='1.5'; range.step='0.01'; range.value='1';
    const val = document.createElement('span'); val.className='hint'; val.textContent='وزن: 1.00';
    range.addEventListener('input', e=>{
      const w = Number(e.target.value); weights[d.key]=w; val.textContent = 'وزن: ' + w.toFixed(2);
      updateRadar();
    });
    row.appendChild(lab); row.appendChild(range); row.appendChild(val);
    controls.appendChild(row);
  });

  updateRadar();
})();

/* ======= الخط الزمني (SVG) ======= */
(function renderLine(){
  const svg = document.getElementById('line');
  const W = 600, H = 320, pad = 32;
  const x0 = pad, x1 = W - pad, y0 = H - pad, y1 = pad;

  const maxY = Math.max(...daily.map(d=>d.victims), 10);
  const minX = 1, maxX = 9;
  const sx = v => x0 + (v-minX)/(maxX-minX)*(x1-x0);
  const sy = v => y0 - (v/maxY)*(y0-y1);

  // شبكة بسيطة
  const grid = document.createElementNS('http://www.w3.org/2000/svg','g');
  grid.setAttribute('stroke','#e5e7eb'); grid.setAttribute('stroke-width','1');
  svg.appendChild(grid);
  for(let gy=0; gy<=maxY; gy+=Math.max(1,Math.ceil(maxY/5))){
    const y=sy(gy); const ln=document.createElementNS('http://www.w3.org/2000/svg','line');
    ln.setAttribute('x1',x0); ln.setAttribute('y1',y); ln.setAttribute('x2',x1); ln.setAttribute('y2',y); grid.appendChild(ln);
    const tt=document.createElementNS('http://www.w3.org/2000/svg','text'); tt.setAttribute('x',x0-6); tt.setAttribute('y',y+4);
    tt.setAttribute('font-size','11'); tt.setAttribute('text-anchor','end'); tt.textContent=gy; svg.appendChild(tt);
  }
  for(let d=1; d<=9; d++){
    const x=sx(d); const ln=document.createElementNS('http://www.w3.org/2000/svg','line');
    ln.setAttribute('x1',x); ln.setAttribute('y1',y0); ln.setAttribute('x2',x); ln.setAttribute('y2',y0+4); ln.setAttribute('stroke','#cbd5e1');
    svg.appendChild(ln);
    const tt=document.createElementNS('http://www.w3.org/2000/svg','text'); tt.setAttribute('x',x); tt.setAttribute('y',y0+18);
    tt.setAttribute('font-size','11'); tt.setAttribute('text-anchor','middle'); tt.textContent='يوم '+d; svg.appendChild(tt);
  }

  // المسار
  const path = document.createElementNS('http://www.w3.org/2000/svg','path');
  const dStr = daily.map((p,i)=> (i? 'L':'M') + sx(p.day)+','+sy(p.victims)).join(' ');
  path.setAttribute('d', dStr);
  path.setAttribute('fill','none'); path.setAttribute('stroke','#0f172a'); path.setAttribute('stroke-width','2');
  svg.appendChild(path);

  // نقاط + تلميحات
  daily.forEach(p=>{
    const cx = sx(p.day), cy = sy(p.victims);
    const dot = document.createElementNS('http://www.w3.org/2000/svg','circle');
    dot.setAttribute('cx',cx); dot.setAttribute('cy',cy); dot.setAttribute('r',4); dot.setAttribute('fill','#0f172a');
    dot.addEventListener('mousemove',(e)=>showTip(`اليوم ${p.day}: ${p.victims}`, e.clientX, e.clientY));
    dot.addEventListener('mouseleave',hideTip);
    svg.appendChild(dot);
  });

  // محاور
  const axisX=document.createElementNS('http://www.w3.org/2000/svg','line');
  axisX.setAttribute('x1',x0); axisX.setAttribute('y1',y0); axisX.setAttribute('x2',x1); axisX.setAttribute('y2',y0);
  axisX.setAttribute('stroke','#cbd5e1'); svg.appendChild(axisX);
  const axisY=document.createElementNS('http://www.w3.org/2000/svg','line');
  axisY.setAttribute('x1',x0); axisY.setAttribute('y1',y0); axisY.setAttribute('x2',x0); axisY.setAttribute('y2',y1);
  axisY.setAttribute('stroke','#cbd5e1'); svg.appendChild(axisY);
})();
</script>
</body>
</html>

<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>أنفوغرافيك – الأبعاد الاستراتيجية</title>
  <style>
    html, body, #root { height: 100%; margin: 0; background:#fafafa; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 16px; }
    .card { background:#fff; border:1px solid #e5e7eb; border-radius:16px; padding:16px; box-shadow:0 1px 8px rgba(0,0,0,.06); }
    .err { background: #fff3f3; color:#b00020; border:1px solid #f1c0c0; padding:12px; border-radius:12px; margin:16px; }
  </style>

  <!-- React/ReactDOM عبر jsDelivr (UMD) -->
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Recharts عبر jsDelivr (UMD) -->
  <script src="https://cdn.jsdelivr.net/npm/recharts/umd/Recharts.min.js"></script>
</head>
<body>
  <div id="root"><noscript>هذا المحتوى يحتاج JavaScript مفعّل.</noscript></div>

  <script>
    // طبقة أمان: إظهار سبب المشكلة بدلاً من صفحة بيضاء
    function showError(msg) {
      const box = document.createElement('div');
      box.className = 'err';
      box.innerText = msg;
      document.body.prepend(box);
    }

    // تحقق من تحميل المكتبات
    if (!window.React) {
      showError('فشل تحميل React. تحقق من اتصالك أو جرب شبكة مختلفة.');
    }
    if (!window.ReactDOM) {
      showError('فشل تحميل ReactDOM.');
    }
    if (!window.Recharts) {
      showError('فشل تحميل Recharts (مكتبة الرسوم). قد يكون الحجب من الشبكة. جرب VPN أو افتح من متصفح آخر.');
    }

    if (!(window.React && window.ReactDOM && window.Recharts)) {
      // إيقاف التنفيذ إن كانت المكتبات غير متاحة
      throw new Error('Required libraries did not load.');
    }

    const { createElement: h, useState, useMemo } = React;
    const {
      ResponsiveContainer, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend,
      Radar, RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, LineChart, Line
    } = Recharts;

    // بيانات المقال
    const baseVictims = [
      { name: "حلب", value: 8 },
      { name: "حمص", value: 6 },
      { name: "ريف دمشق", value: 5 },
      { name: "حماة", value: 3 },
      { name: "اللاذقية", value: 2 },
      { name: "دمشق", value: 2 },
      { name: "طرطوس", value: 1 },
    ];
    const total = baseVictims.reduce((a,b)=>a+b.value,0);

    function App(){
      const [w, setW] = useState({vac:1, sect:1, imp:1, reg:1, soc:1, fut:1});
      const dims = [
        {k:'vac',  name:'فراغ أمني',           score:9, desc:'تآكل قدرة الدولة على الردع.'},
        {k:'sect', name:'تفكك طائفي',          score:8, desc:'تصاعد الهويات الصغرى.'},
        {k:'imp',  name:'إفلات من العقاب',     score:9, desc:'ضعف المساءلة القضائية.'},
        {k:'reg',  name:'تسرّب إقليمي',        score:6, desc:'قابلية الحدود للتوظيف.'},
        {k:'soc',  name:'تآكل العقد الاجتماعي',score:8, desc:'الانكفاء للعائلة والطائفة.'},
        {k:'fut',  name:'مخاطر مستقبلية',      score:7, desc:'توريث منطق الثأر.'},
      ];
      const radarData = useMemo(()=>dims.map(d=>({
        dim:d.name, val: Math.min(10, d.score*(w[d.k]||1))
      })), [w]);

      const days = [5,2,5,1,6,2,3,3,0];
      days[8] = Math.max(0, 27 - days.slice(0,8).reduce((a,b)=>a+b,0));
      const daily = days.map((v,i)=>({day:i+1, victims:v}));

      return h('div', {className:'wrap', style:{direction:'rtl'}},
        h('h1', {style:{margin:'6px 0 2px'}}, 'أنفوغرافيك تفاعلي – الأبعاد الاستراتيجية لموجة التصفيات'),
        h('div', {style:{color:'#555', marginBottom:12}}, `الفترة: 1–9 آب 2025 — إجمالي الضحايا: ${total}`),

        // رادار
        h('div', {className:'card', style:{marginBottom:12}},
          h('h3', null, 'مصفوفة المخاطر (رادار)'),
          h('div', {style:{height:320}},
            h(ResponsiveContainer, {width:'100%', height:'100%'},
              h(RadarChart, {data: radarData, outerRadius:'80%'},
                h(PolarGrid, null),
                h(PolarAngleAxis, {dataKey:'dim', tick:{fontSize:12}}),
                h(PolarRadiusAxis, {domain:[0,10]}),
                h(Tooltip, {formatter:(v)=>[`${v} / 10`, 'المستوى']}),
                h(Radar, {dataKey:'val', name:'المخاطر', stroke:'#111827', fill:'#111827', fillOpacity:0.35})
              )
            )
          ),
          h('div', {style:{display:'grid', gridTemplateColumns:'repeat(2,1fr)', gap:8, marginTop:8}},
            dims.map(d => h('div', {key:d.k, style:{fontSize:14}},
              h('div', {style:{display:'flex', justifyContent:'space-between', marginBottom:4}},
                h('strong', null, d.name),
                h('span', {style:{fontSize:12, color:'#666'}}, `وزن: ${w[d.k].toFixed(2)}`)
              ),
              h('input', {
                type:'range', min:0.5, max:1.5, step:0.01, value:w[d.k],
                onInput:(e)=>setW({...w, [d.k]: Number(e.target.value)}),
                style:{width:'100%'}
              }),
              h('div', {style:{fontSize:12, color:'#666', marginTop:4}}, d.desc)
            ))
          )
        ),

        // خط زمني
        h('div', {className:'card', style:{marginBottom:12}},
          h('h3', null, 'التطور اليومي (1–9 آب)'),
          h('div', {style:{height:260}},
            h(ResponsiveContainer, {width:'100%', height:'100%'},
              h(LineChart, {data: daily, margin:{top:10, right:10, left:0, bottom:0}},
                h(CartesianGrid, {strokeDasharray:'3 3'}),
                h(XAxis, {dataKey:'day', tickFormatter:(d)=>`يوم ${d}`}),
                h(YAxis, {allowDecimals:false}),
                h(Tooltip, {formatter:(v)=>[v, 'ضحايا'], labelFormatter:(l)=>`اليوم ${l}`}),
                h(Line, {type:'monotone', dataKey:'victims', stroke:'#0f172a', dot:true})
              )
            )
          )
        ),

        // المحافظات
        h('div', {className:'card'},
          h('h3', null, 'توزيع الضحايا حسب المحافظات'),
          h('div', {style:{height:320}},
            h(ResponsiveContainer, {width:'100%', height:'100%'},
              h(BarChart, {data: baseVictims, margin:{top:10, right:10, left:0, bottom:0}},
                h(CartesianGrid, {strokeDasharray:'3 3'}),
                h(XAxis, {dataKey:'name'}),
                h(YAxis, {allowDecimals:false}),
                h(Tooltip, {formatter:(v)=>[v, 'ضحايا']}),
                h(Legend, null),
                h(Bar, {dataKey:'value', name:'عدد الضحايا', fill:'#0f172a'})
              )
            )
          )
        )
      );
    }

    // بدء التطبيق
    try {
      ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
    } catch (e) {
      showError('فشل بدء التطبيق: ' + (e && e.message ? e.message : e));
      console.error(e);
    }
  </script>
</body>
</html>
